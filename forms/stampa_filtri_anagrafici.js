// CAMPI AUSILIARI

/**
 * @type {Date}
 * 
 * @properties={typeid:35,uuid:"8D32AF94-BE3A-455D-928D-7E3CC5FF1ABB",variableType:93}
 */
var vDateTo = null;

// CAMPI DI FILTRAGGIO

/**
 * @properties={typeid:35,uuid:"FD1EF13B-8CB7-4EA5-A62B-71DFA5786458",variableType:-4}
 */
var vContratto = null;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B4519DC2-9903-40E6-9213-6F3577CA6E2D"}
 */
var vContrattoString = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4381200D-C753-49F6-BCCF-E82BD2CB13F0",variableType:4}
 */
var vFilterContratto = 0;

/**
 * @properties={typeid:35,uuid:"BF0ED368-0522-4844-8F78-569D417E25BC",variableType:-4}
 */
var vQualifica = null;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C52899FA-8EDF-46AB-914D-DDDD47223ACF"}
 */
var vQualificaString = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"281BFFFC-7109-48E8-9581-77A96518538B",variableType:4}
 */
var vFilterQualifica = 0;

/**
 * @properties={typeid:35,uuid:"36D6E857-07ED-4BB3-93D3-08D11ED22849",variableType:-4}
 */
var vPosizioniInps = null;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"E51468C3-99A0-46B6-9267-EDF676F1877C"}
 */
var vPosizioneinpsString = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"23018654-EE25-4884-ADFF-DA180C7B65C4",variableType:4}
 */
var vFilterPosizioneInps = 0;

/**
 * @properties={typeid:35,uuid:"E61478AD-044A-41E6-9CEE-9ED68C555A28",variableType:-4}
 */
var vSediLavoro = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1EE5EB5D-8E2C-49EC-AE82-CE8F436BBCCC"}
 */
var vSedelavoroString = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1EA9BDC5-FFE0-4728-AFEB-47140760F073",variableType:4}
 */
var vFilterGroupLavoratori = 0;

/**
 * @properties={typeid:35,uuid:"208FE390-7579-4B32-9AFE-CD2B94EAA84B",variableType:-4}
 */
var vGroupLavoratori = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"CCBD0885-D55A-4F44-A125-E09C74AAF58F"}
 */
var vGroupLavoratoriString = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"23B6EAB1-592E-4DD4-A5C0-14AB9F3CFC4B",variableType:4}
 */
var vFilterSedeLavoro = 0;

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"9BE988AF-9DF7-47EF-A2FF-28BE7639DFC3"}
 */
var vRaggruppamento = null;

/**
 * @type {Number}
 *
 *
 * @properties={typeid:35,uuid:"E2AE6315-FEEC-429A-BD86-6B214AFC4915",variableType:4}
 */
var vRaggruppamentoCodice = 0;

/**
 * @properties={typeid:35,uuid:"3E744416-BFA2-403C-8B32-ADBACA8F73FB",variableType:-4}
 */
var vRaggruppamentoTipoCampo = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C0DAB204-9C7A-4DCD-BC11-D23AEFF2F30F"}
 */
var vRaggruppamentoString = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A0CA0E3C-B102-4073-AF08-0C96A17588C3",variableType:4}
 */
var vFilterRaggruppamento = 0;

/**
 * @properties={typeid:35,uuid:"F8109B7E-3AFA-4841-A7E0-4A23E56163A9",variableType:-4}
 */
var vRaggruppamentiDettaglio = null;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"076BB972-DE06-487E-8203-549C09A1851A"}
 */
var vRaggruppamentiDettaglioString = '';

/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"6C2B77B1-6B3D-4345-AA27-E07B8628F3F1",variableType:-4}
 */
var vGroupContratto = false;
/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"E001B4C1-4426-4E13-B7CB-2E475EE35511",variableType:-4}
 */
var vGroupQualifica = false;
/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"C4094AC8-7AA9-4E6F-B9CE-62DFC4F86E99",variableType:-4}
 */
var vGroupPosizioneinps = false;
/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"69DC85B7-9993-439E-A755-2C47464893EB",variableType:-4}
 */
var vGroupSedelavoro = false;
/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"F94D12AE-FC3E-4C43-ABE6-51C1BE818C38",variableType:-4}
 */
var vGroupRaggruppamento = false;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E1E4DE7D-B169-4B2C-8B93-C25AE467ADDA",variableType:4}
 */
var vGroupTipoRaggruppamento = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2CD63D4F-42F9-41B3-8DB8-4ED366EFDD9C",variableType:4}
 */
var vIdDittaClassificazione = -1;

/**
 * @param {JSEvent} event
 * @param {Number} oldValue
 * @param {Number} newValue
 * 
 * @private
 *
 * @properties={typeid:24,uuid:"C5B47B28-0E84-4C09-A187-869614D8C353"}
 */
function onDataChangeFilter(oldValue, newValue, event) 
{
	/**
	 * 1. Recupera il nome dell'elemento su cui filtrare
	 */
	var elementName = event.getElementName();
	if(!elementName)
		return false;
	
	var splitName = elementName.split('_')[1];
	updateStatus(splitName, newValue);
	
	if(!newValue)
		reset(splitName[0].toUpperCase() + splitName.slice(1, splitName.length));
	
	return true;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"82BA19E2-734F-4B85-BAD8-C12604828F1C"}
 */
function onDataChangeRaggruppamento(oldValue, newValue, event)
{
	vRaggruppamentiDettaglioString = '';
		
	elements.fld_raggruppamento.enabled = newValue;
	elements.chk_group_raggruppamento.enabled = newValue;
	
	if(!newValue)
	{
		vRaggruppamentiDettaglio = null;
		application.setValueListItems('vls_raggruppamenti',[],[]);
	}
	else
	{
		var realValues = new Array();
		var displayValues = new Array();
		
		var ds = globals.getClassificazioniDitta(idditta);
		if(ds && ds.getMaxRowIndex())
		{
			for(var r = 1; r <= ds.getMaxRowIndex(); r++)
			{
				// iddittaclassificazione
				realValues.push(ds.getValue(r,1) + ' ' + ds.getValue(r,2));
				// codice + ' - ' + descrizione
				displayValues.push(ds.getValue(r,2) + ' - ' + ds.getValue(r,3))
			}
		}		
		application.setValueListItems('vls_raggruppamenti',displayValues,realValues);
	}
	return onDataChangeFilter(oldValue, newValue, event);
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"3FC7DC3E-5B92-4B2F-AEB4-98093BBE29DA"}
 */
function onDataChangeRaggruppamentoDettaglio(oldValue, newValue, event)
{
	var split = newValue.split(" ");
//	vRaggruppamentoTipoCampo = split[0];
    vRaggruppamentoCodice = split[1];
    vIdDittaClassificazione = split[0];
    
    vRaggruppamentiDettaglioString = '';
	reset('vRaggruppamentiDettaglio');
	return true;
}

/**
 * @param {String} name
 * @param {Number} status
 *
 * @properties={typeid:24,uuid:"BA0719E3-D7CA-4E6F-95C3-1A319C23763F"}
 */
function updateStatus(name, status)
{
	/**
	 * 2. Abilita/Disabilita il pulsante corrispondente
	 */
	var btnName = ['btn', name].join('_');
	elements[btnName] && (elements[btnName].enabled = status);
	
	/**
	 * 3. Abilita/Disabilita il checkbox di raggruppamento corrispondente
	 */
	var orderName = ['chk', 'group', name].join('_');
	elements[orderName] && (elements[orderName].enabled = status);
	if(!status)
		forms[controller.getName()]['vGroup' + name.substring(0,1).toUpperCase() + name.substr(1)] = elements[orderName].visible ? status : 0;
}

/**
 * @param {String} name
 *
 * @properties={typeid:24,uuid:"CD307A08-1A28-41F3-B2F0-3BB229BBA662"}
 */
function reset(name)
{
	var form = forms[controller.getName()];
	var variableName = ['v', name].join('');
	
	if(form && null !== form[variableName])
		form[variableName] = null;
	
	var stringVariableName = ['v', name, 'String'].join('');
	if(form && null !== form[stringVariableName])
		form[stringVariableName] = null;
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/ditte_contratti>} fs
 *
 * @properties={typeid:24,uuid:"C272332B-24CE-4E84-A08B-3417194202BC"}
 */
function filterContratto(fs)
{
	var vIdDitta = idditta;
	if(globals.isInterinale(idditta))
		vIdDitta = globals.getDittaRiferimento(idditta);
	return filter(fs, 'SELECT idGruppoContrattuale FROM [dbo].[F_Ditta_Contratti_Al](?,?)', [vIdDitta, vDateTo]);
}

/**
 * @param {JSFoundSet<db:/ma_presenze/e2tabqualifiche>} fs
 *
 * @properties={typeid:24,uuid:"DFC94310-62C9-4F10-87AA-C9E99014AE85"}
 */
function filterQualifica(fs)
{
	var vIdDitta = idditta;
	if(globals.isInterinale(idditta))
		vIdDitta = globals.getDittaRiferimento(idditta);
	return filter(fs, 'SELECT idTabQualifiche FROM [dbo].[F_Ditta_Qualifiche_Al](?,?)', [vIdDitta, vDateTo]);
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/ditte_inps>} fs
 *
 * @properties={typeid:24,uuid:"BAA19C3C-ED0E-4A9D-9F64-88F4C001ECBC"}
 */
function filterPosizioneInps(fs)
{
	var vIdDitta = idditta;
	if(globals.isInterinale(idditta))
		vIdDitta = globals.getDittaRiferimento(idditta);
	return filter(fs, 'SELECT idDittaInps FROM [dbo].[F_Ditta_PosizioneInps_Al](?,?)', [vIdDitta, vDateTo]);
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/ditte_sedi>} fs
 *
 * @properties={typeid:24,uuid:"7E770D48-46E7-4B9B-A6D1-B4559D655064"}
 */
function filterSedeLavoro(fs)
{
	var vIdDitta = idditta;
	if(globals.isInterinale(idditta))
		vIdDitta = globals.getDittaRiferimento(idditta);
	fs = filter(fs, 'SELECT idDittaSede FROM [dbo].[F_Ditta_Sedi_Al](?,?)', [vIdDitta, vDateTo]);
	fs.addFoundSetFilterParam('codtiposede', globals.ComparisonOperator.EQ, globals.codSEDEOPERATIVA);
	
	return fs;
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/ditte_presenzegruppigestione>} fs
 *
 * @properties={typeid:24,uuid:"ACD67397-C47F-4B07-B7C7-740095E376B1"}
 */
function filterGruppiLavoratori(fs)
{
	fs.addFoundSetFilterParam('idditta','=',idditta);
	return fs;
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/v_ditte_raggruppamenti_dettaglio>} fs
 *
 * @properties={typeid:24,uuid:"D802925B-BE21-4C7C-BAD0-1510A4B4222B"}
 */
function filterRaggruppamento(fs)
{
	if(vRaggruppamentoTipoCampo == null)
	{
		globals.ma_utl_showWarningDialog('Selezionare un tipo di raggruppamento','Filtri anagrafici per stampa');
	    return null;
	}
	
	return filter(fs
				  , 'SELECT idDettaglio FROM [dbo].[F_Ditta_Raggruppamenti_Al](?,?,?)'
				  , [idditta, vDateTo, vRaggruppamentoTipoCampo]);
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/ditte_classificazioni>} fs
 *
 * @properties={typeid:24,uuid:"FB8ABE65-9DE4-41B1-8CBD-42D425CD3BF9"}
 */
function filterRaggruppamentoDettaglio(fs)
{
	fs.addFoundSetFilterParam('iddittaclassificazione'
		                      ,'IN'
							  ,vIdDittaClassificazione);
	return fs;
	
//	return filter(fs
//		          , 'SELECT idDettaglio FROM [dbo].[F_Ditta_Raggruppamenti_Al](?,?,?)'
//				  , [vIdDitta, vDateTo, vRaggruppamentoTipoCampo]);
}

/**
 * @properties={typeid:24,uuid:"630B2945-F3F3-4923-871A-76CDC0429046"}
 */
function filter(fs, sql, args)
{
	var table = databaseManager.getTable(fs);
	if (!table)
		throw 'Table not found for datasource: ' + fs.getDataSource();
	
	var pkName = table.getRowIdentifierColumnNames()[0];
	
	var ds = databaseManager.getDataSetByQuery(globals.Server.MA_ANAGRAFICHE, sql, args, -1);
	if(ds.getMaxRowIndex() > 0)
		fs.addFoundSetFilterParam(pkName, 'IN', ds.getColumnAsArray(1));
	
	return fs;
}

/**
 * @param {Array<JSRecord<db:/ma_presenze/e2tabgruppicontrattuali>>} records
 *
 * @properties={typeid:24,uuid:"AC31198D-39F6-48CB-8B3F-D9AAE09D41F0"}
 */
function updateContratto(records)
{
	if(records)
	{
		var temp = [];
		records.forEach
		(
			function(record)
			{
				temp.push(record.radicecontratto + ' - ' + record.descrizione);
			}
		);
		
		vContrattoString = temp.join('\n');
		vContratto = records.map(function(record){ return record.radicecontratto; });
	}
}

/**
 * @param {Array<JSRecord<db:/ma_presenze/e2tabqualifiche>>} records
 *
 * @properties={typeid:24,uuid:"0E2A08FF-9578-449E-B984-7E6149BC7C19"}
 */
function updateQualifica(records)
{
	if(records)
	{
		var temp = [];
		records.forEach
		(
			function(record)
			{
				temp.push(record.radicequalifica + ' - ' + record.descrizione);
			}
		);
		
		vQualificaString = temp.join('\n');
		vQualifica = records.map(function(record){ return '\'' + record.radicequalifica + '\''; });
	}
}

/**
 * @param {Array<JSRecord<db:/ma_anagrafiche/ditte_inps>>} records
 *
 * @properties={typeid:24,uuid:"12BF2A46-159A-45EA-B520-1493A296C2D8"}
 */
function updatePosizioneInps(records)
{
	if(records)
	{
		var temp = [];
		records.forEach
		(
			function(record)
			{
				temp.push(record.posizioneinps + ' - ' + record.ditte_inps_to_ditte_attivita.descrizioneateco);
			}
		);
		
		vPosizioneinpsString = temp.join('\n');
		vPosizioniInps = records.map(function(record){ return record.posizioneinps; });
	}
}

/**
 * @param {Array<JSRecord<db:/ma_anagrafiche/ditte_sedi>>} records
 *
 * @properties={typeid:24,uuid:"08EFC837-993A-4475-B044-D988330CF567"}
 */
function updateSedeLavoro(records)
{
	if(records)
	{
		var temp = [];
		records.forEach
		(
			function(record)
			{
				temp.push(record.codice + ' - ' + record.descrizione);
			}
		);
		
		vSedelavoroString = temp.join('\n');
		vSediLavoro = records.map(function(record){ return record.iddittasede; });
	}
}

/**
 * @param {Array<JSRecord<db:/ma_anagrafiche/v_ditte_raggruppamenti_dettaglio>>} records
 *
 * @properties={typeid:24,uuid:"510E40D1-8030-4752-A163-87E5EF58E726"}
 */
function updateRaggruppamentoDettaglio(records)
{
	if(records)
	{
		var temp = [];
		records.forEach
		(
			function(record)
			{
				temp.push(record.codice + ' - ' + record.descrizione);
			}
		);
		
		vRaggruppamentiDettaglioString = temp.join('\n');
		vRaggruppamentiDettaglio = records.map(function(record){ return record.codice; });
	}
}

/**
 * @param {JSRecord<db:/ma_anagrafiche/ditte_presenzegruppigestione>} record
 *
 * @properties={typeid:24,uuid:"E1E55F20-EB52-4FAF-8AAB-B68240677172"}
 */
function updateGruppoLavoratori(record)
{
	if(record)
	{
		vGroupLavoratoriString = record.codice + ' - ' + record.descrizione;
		vGroupLavoratori = record.codice; 
	}
}

/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"E4FC93EB-F2ED-4254-8441-DCAEA40C049F"}
 */
function onDataChangeGruppoLavoratori(oldValue, newValue, event) 
{
    if(!newValue)
    {
    	vGroupLavoratori = '';
    	vGroupLavoratoriString = '';
    	elements.btn_gruppo_lavoratori.enabled = false;
    }
    else
    	elements.btn_gruppo_lavoratori.enabled = true;
    
	return true
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @private
 *
 * @properties={typeid:24,uuid:"09B3EE31-896D-442A-8E8E-F145079279F5"}
 */
function onShowForm(firstShow, event)
{	
	vDateTo = globals.TODAY;
	resetAll();
	gotoBrowse();
}

/**
 * @properties={typeid:24,uuid:"50A69D47-296B-4690-BBDB-BB30A267605D"}
 */
function resetAll()
{
	globals.resetAll(controller.getName());
	
	var jsForm = solutionModel.getForm(controller.getName());
	var lbls = jsForm.getLabels();
	for(var label in lbls)
	{
		if(elements[lbls[label].name])
			elements[lbls[label].name].enabled = false;
	}
}

/**
 * @param {JSFoundSet<db:/ma_anagrafiche/lavoratori>} _fs
 * @param {Boolean} [stampaDaGiornaliera]
 * 
 * @properties={typeid:24,uuid:"1A445D01-7697-43EC-943E-E228FAFE1EB3"}
 * @AllowToRunInFind
 */
function filterLavoratori(_fs,stampaDaGiornaliera)
{
	var fs = _fs.duplicateFoundSet();
	var frmStampaFiltriAnag = forms.stampa_filtri_anagrafici;
	if(fs.find())
	{
		fs.idditta = globals.foundsetToArray(foundset,'idditta');//idditta;

		// Ticket 17098
//		if(frmStampaFiltriAnag.vFilterRaggruppamento)
//			fs.lavoratori_to_lavoratori_classificazioni.codtipoclassificazione = vRaggruppamentoCodice;
		if(frmStampaFiltriAnag.vFilterRaggruppamento && 
				frmStampaFiltriAnag.vRaggruppamentiDettaglio)
		{
			fs.lavoratori_to_lavoratori_classificazioni.codtipoclassificazione = vRaggruppamentoCodice;
			fs.lavoratori_to_lavoratori_classificazioni.codclassificazione = vRaggruppamentiDettaglio;
		}
		if(frmStampaFiltriAnag.vFilterContratto)
			fs.codcontratto = vContratto;
		if(frmStampaFiltriAnag.vFilterQualifica)
			fs.codqualifica = vQualifica;
		if(frmStampaFiltriAnag.vFilterPosizioneInps)
			fs.posizioneinps = vPosizioniInps;
		
		// filtro sedi di lavoro
		if(frmStampaFiltriAnag.vFilterSedeLavoro)
			fs.iddittasede = vSediLavoro;
		
		if(frmStampaFiltriAnag.vFilterGroupLavoratori)
		{
			if(vDateTo == null)
				vDateTo = globals.TODAY;
			
			var params = globals.inizializzaParametriAttivaMese
			(
				idditta, 
	            vDateTo.getFullYear() * 100 + vDateTo.getMonth() + 1,
				globals.getGruppoInstallazioneDitta(idditta), 
				vGroupLavoratori,
				globals._tipoConnessione
			);
			
	        var arrLavGruppo = globals.getLavoratoriGruppo(params,params.idditta);
	        fs.addFoundSetFilterParam('idlavoratore',globals.ComparisonOperator.IN,arrLavGruppo);
		}
		
		fs.search(); 
		
		_fs.addFoundSetFilterParam('idlavoratore',globals.ComparisonOperator.IN,globals.foundsetToArray(fs,'idlavoratore'));
	}
	
	return _fs;
}

/**
 * @param {Date} from
 * @param {Date} to
 * 
 * @return {JSFoundSet<db:/ma_anagrafiche/lavoratori>}
 * 
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"9AA23A38-632E-48FA-B66C-855D675FA735"}
 */
function getLavoratori(from,to)
{
	/** @type {JSFoundSet<db:/ma_anagrafiche/lavoratori>}*/
	var fs = databaseManager.getFoundSet(globals.Server.MA_ANAGRAFICHE,globals.Table.LAVORATORI);
	var frmStampaFiltriAnag = forms.stampa_filtri_anagrafici;
	if(fs.find())
	{
		fs.idditta = globals.foundsetToArray(foundset,'idditta');
		
		fs.assunzione = '<=' + globals.dateFormat(to,globals.ISO_DATEFORMAT) + '|yyyyMMdd';
		fs.cessazione = '^||>=' + globals.dateFormat(from,globals.ISO_DATEFORMAT) + '|yyyyMMdd'
		
		if(frmStampaFiltriAnag.vFilterRaggruppamento)
			fs.lavoratori_to_lavoratori_classificazioni.codtipoclassificazione = vRaggruppamentoCodice;
		if(frmStampaFiltriAnag.vRaggruppamentiDettaglio)
			fs.lavoratori_to_lavoratori_classificazioni.codclassificazione = vRaggruppamentiDettaglio;
		if(frmStampaFiltriAnag.vFilterContratto)
			fs.codcontratto = vContratto;
		if(frmStampaFiltriAnag.vFilterQualifica)
			fs.codqualifica = vQualifica;
		if(frmStampaFiltriAnag.vFilterPosizioneInps)
			fs.posizioneinps = vPosizioniInps;
		// filtro sedi di lavoro
		if(frmStampaFiltriAnag.vFilterSedeLavoro)
			fs.iddittasede = vSediLavoro;

		if(frmStampaFiltriAnag.vFilterGroupLavoratori)
		{
			if(vDateTo == null)
				vDateTo = globals.TODAY;
			
			var params = globals.inizializzaParametriAttivaMese
			(
				idditta, 
	            vDateTo.getFullYear() * 100 + vDateTo.getMonth() + 1,
				globals.getGruppoInstallazioneDitta(idditta), 
				vGroupLavoratori,
				globals._tipoConnessione
			);
			
	        var arrLavGruppo = globals.getLavoratoriGruppo(params,params.idditta);
	        fs.addFoundSetFilterParam('idlavoratore',globals.ComparisonOperator.IN,arrLavGruppo);
	    }
		
		fs.search(); 
				
	}
	
	return fs;
}

/**
 * @properties={typeid:24,uuid:"7E3A9746-59E2-4E7E-807B-466DFD869BA0"}
 */
function gotoBrowse()
{
	elements.fld_raggruppamento.enabled = false;
	elements.btn_raggruppamento.enabled = false;
}

/**
 * @return {Boolean}
 * 
 * @properties={typeid:24,uuid:"3436AD9C-88FD-4E02-B63D-D9686D46549A"}
 */
function validaFiltriAnagrafici()
{
	var resp = true;
	var msg = "Compilare i filtri anagrafici della sezione relativa ";
	
	if(vFilterContratto && !vContratto)
	{
		resp = false;
		msg += "ai contratti di lavoro";
	}
	else if(vFilterQualifica && !vQualifica)
	{
		resp = false;
		msg += "alle qualifiche";
	}
	else if(vFilterPosizioneInps && !vPosizioniInps)
	{
		resp = false;
		msg += "alle posizioni INPS";
	}
	else if(vFilterSedeLavoro && !vSediLavoro)
	{
		resp = false;
		msg += "alle sedi di lavoro";
	}
	else if(vFilterRaggruppamento && !vRaggruppamento)
	{
		resp = false;
		msg += "ai raggruppamenti";
	}
	else if(vFilterGroupLavoratori && !vGroupLavoratori)
	{
		resp = false;
		msg += "ai gruppi di lavoratori";
	}
	
	if(!resp)
		globals.ma_utl_showWarningDialog(msg);
	
	return resp;
}